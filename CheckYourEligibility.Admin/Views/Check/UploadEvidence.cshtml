@model FsmApplication;

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Send supporting evidence";
}

<div class="govuk-grid-column-two-thirds">
    <a class="govuk-back-link" href="@Url.Action("Index", "Home")" onclick="history.back(); return false;">Back</a>
    @* <a class="govuk-back-link-nolink"></a> *@

    <h1 class="govuk-heading-l govuk-!-margin-bottom-4">@ViewData["Title"]</h1>

    <p class="govuk-body">Your local authority will need to see supporting evidence for this application.</p>
    <p>Upload the evidence here or send copies by email later.</p>
    <p>View <a href="#" class="govuk-link">guidance about supporting evidence (opens in a new window)</a>.</p>

    @if (!ViewData.ModelState.IsValid)
    {
        <div class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="govuk-error-summary">
            <h2 class="govuk-error-summary__title" id="error-summary-title">
                There is a problem
            </h2>
            <div class="govuk-error-summary__body">
                <ul class="govuk-list govuk-error-summary__list">
                    @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                    {
                        <li>@error.ErrorMessage</li>
                    }
                </ul>
            </div>
        </div>
    }

    @if (Model.Evidence?.EvidenceList?.Count > 0)
    {
        <div class="govuk-summary-card govuk-!-margin-bottom-6">
            <div class="govuk-summary-card__title-wrapper">
                <h2 class="govuk-summary-card__title">Uploaded files</h2>
            </div>
            <div class="govuk-summary-card__content">
                <dl class="govuk-summary-list">
                    @foreach (var file in Model.Evidence.EvidenceList)
                    {
                        <div class="govuk-summary-list__row">
                            <dt class="govuk-summary-list__key">
                                @file.FileName
                            </dt>
                            <dd class="govuk-summary-list__value">
                                Uploaded successfully
                            </dd>
                        </div>
                    }
                </dl>
            </div>
        </div>
    }

    <form asp-action="UploadEvidence" asp-controller="Check" method="post" enctype="multipart/form-data" novalidate="">
        @* Pretty sure there is a way around having to include all these hidden attributes. Please help me code better!*@
        <!-- Parent Details -->
        <input type="hidden" asp-for="ParentFirstName" value="@Model.ParentFirstName" />
        <input type="hidden" asp-for="ParentLastName" value="@Model.ParentLastName" />
        <input type="hidden" asp-for="ParentNass" value="@Model.ParentNass" />
        <input type="hidden" asp-for="ParentNino" value="@Model.ParentNino" />
        <input type="hidden" asp-for="ParentDateOfBirth" value="@Model.ParentDateOfBirth" />
        <input type="hidden" asp-for="ParentEmail" value="@Model.ParentEmail" />

        <!-- Child details -->
        @for (var i = 0; i < Model.Children.ChildList.Count; i++)
        {
            <input type="hidden" asp-for="Children.ChildList[i].FirstName" />
            <input type="hidden" asp-for="Children.ChildList[i].LastName" />
            <input type="hidden" asp-for="Children.ChildList[i].Day" />
            <input type="hidden" asp-for="Children.ChildList[i].Month" />
            <input type="hidden" asp-for="Children.ChildList[i].Year" />
            <input type="hidden" asp-for="Children.ChildList[i].School.URN" />
            <input type="hidden" asp-for="Children.ChildList[i].School.Name" />
            <input type="hidden" asp-for="Children.ChildList[i].School.LA" />
        }

        <div class="govuk-form-group">
            <label class="govuk-label" for="EvidenceFiles">
                Upload a file
            </label>
            <div class="govuk-drop-zone" data-module="govuk-file-upload">
                <input class="govuk-file-upload" id="EvidenceFiles" name="EvidenceFiles" type="file" multiple>
            </div>
        </div>

        <button type="submit" class="govuk-button" data-module="govuk-button">
            Attach evidence
        </button>

        @if (Model.Evidence?.EvidenceList?.Count > 0)
        {
            <a asp-action="Check_Answers" asp-controller="Check" class="govuk-button govuk-button--secondary">
                Continue without adding more files
            </a>
        }


        <p class="govuk-body"><a href="#" class="govuk-link">Send by email later</a></p>
    </form>
</div>